import{A as R}from"./AdminSidebar-BJeMK23q.js";import{d as b,r as T,H as r,c as V,b as _,A as q,f as n,e as l,h as C,t as o,q as P,v as O,o as v,N as ee,C as H,l as B,B as te,s as m,k as f,y as U,g as Y,F as se,p as le,m as ae,_ as ne}from"./index-DCiEO1RF.js";import{s as ie}from"./inputtext.esm-Cij7q3me.js";const h=D=>(le("data-v-31e4d351"),D=D(),ae(),D),oe={class:"msg-wrapper"},ue={class:"add-comment"},ce={class:"container"},re={class:"wrapper"},de=h(()=>l("h2",null,"Enrollment Requests",-1)),me={class:"table-container"},pe={class:"row head"},_e=h(()=>l("i",{class:"pi pi-sort-alt"},null,-1)),ve=h(()=>l("i",{class:"pi pi-sort-alt"},null,-1)),fe=h(()=>l("i",{class:"pi pi-sort-alt"},null,-1)),he=h(()=>l("i",{class:"pi pi-sort-alt"},null,-1)),we=h(()=>l("i",{class:"pi pi-sort-alt"},null,-1)),Ce=h(()=>l("i",{class:"pi pi-sort-alt"},null,-1)),ke={class:"row"},ge={style:{display:"flex","flex-direction":"column",gap:"0.5rem","margin-block":"1rem"}},Se=b({__name:"manageRequests",setup(D){const i=T([]),G=new r("get_all_request_enrollment");async function k(){i.value=[],G.callApi().then(s=>{var t;if(s.success==!0)for(let e of(t=s==null?void 0:s.data)==null?void 0:t.requests)new r("personal_another_user_info").callApi({another_userId:e==null?void 0:e.parent_id}).then(u=>{new r("personal_another_user_info").callApi({another_userId:e==null?void 0:e.student_id}).then(p=>{p.success==!0&&(e.package_type=="course"?new r("get_course").callApi({course_id:e==null?void 0:e.course_id}).then(c=>{var S,A,E,I,y,$,x;c.success==!0&&((x=i.value)==null||x.push({id:e==null?void 0:e.id,parentEmail:(A=(S=u==null?void 0:u.data)==null?void 0:S.info)==null?void 0:A.email,childEmail:(I=(E=p==null?void 0:p.data)==null?void 0:E.info)==null?void 0:I.email,courseTitle:($=(y=c==null?void 0:c.data)==null?void 0:y.course)==null?void 0:$.title,date:L(e==null?void 0:e.created_at),status:e==null?void 0:e.status,price:e==null?void 0:e.price,comments:e==null?void 0:e.comments,student_id:e==null?void 0:e.student_id,course_id:e==null?void 0:e.course_id,courses:[],type:"course"}),g.value="",i.value.sort((N,j)=>N.id.localeCompare(j.id)))}):e.package_type=="plan"&&new r("get_plan").callApi({plan_id:e==null?void 0:e.course_id}).then(c=>{var S,A,E,I,y,$,x,N,j;c.success==!0&&((j=i.value)==null||j.push({id:e==null?void 0:e.id,parentEmail:(A=(S=u==null?void 0:u.data)==null?void 0:S.info)==null?void 0:A.email,childEmail:(I=(E=p==null?void 0:p.data)==null?void 0:E.info)==null?void 0:I.email,courseTitle:($=(y=c==null?void 0:c.data)==null?void 0:y.plan)==null?void 0:$.title,date:L(e==null?void 0:e.created_at),status:e==null?void 0:e.status,price:e==null?void 0:e.price,comments:e==null?void 0:e.comments,student_id:e==null?void 0:e.student_id,course_id:e==null?void 0:e.course_id,courses:(N=(x=c==null?void 0:c.data)==null?void 0:x.plan)==null?void 0:N.courses,type:"plan"}),g.value="",i.value.sort((X,Z)=>X.id.localeCompare(Z.id)))}))})})})}k();function L(s){const t=new Date(s),e=t.getFullYear(),a=(t.getMonth()+1).toString().padStart(2,"0"),u=t.getDate().toString().padStart(2,"0");return`${e}-${a}-${u}`}const z=T(!1),F=T(-1),g=T("");function J(){let s={enrollment_request_id:i.value[F.value].id,msg:{msg:g.value}};new r("add_comment").callApi(s).then(e=>{e.success&&k()})}function K(s){if(s.type=="course"){const t=new r("edit_request_status");new r("create_enrollment").callApi({new_enrollment:{student_id:s.student_id,course_id:s.course_id,created_at:new Date().toISOString()}}).then(a=>{a.success&&t.callApi({new_status:"Success",enrollment_request_id:s.id}).then(u=>{u.success&&k()})})}if(s.type=="plan"){const t=new r("edit_request_status");for(let e of s.courses)new r("create_enrollment").callApi({new_enrollment:{student_id:s.student_id,course_id:e==null?void 0:e.Id,created_at:new Date().toISOString()}}).then(u=>{u.success&&t.callApi({new_status:"Success",enrollment_request_id:s.id}).then(M=>{M.success&&k()})})}}function Q(s){new r("edit_request_status").callApi({new_status:"Rejected",enrollment_request_id:s}).then(e=>{e.success&&k()})}const d=T(!1);function w(s){s=="price"?(i.value.sort((t,e)=>(t==null?void 0:t.price)-(e==null?void 0:e.price)),d.value&&i.value.reverse()):s=="parent"?(i.value.sort((t,e)=>{var a;return(a=t==null?void 0:t.parentEmail)==null?void 0:a.localeCompare(e==null?void 0:e.parentEmail)}),d.value&&i.value.reverse()):s=="title"?(i.value.sort((t,e)=>{var a;return(a=t==null?void 0:t.courseTitle)==null?void 0:a.localeCompare(e==null?void 0:e.courseTitle)}),d.value&&i.value.reverse()):s=="date"?(i.value.sort((t,e)=>{var a;return(a=t==null?void 0:t.date)==null?void 0:a.localeCompare(e==null?void 0:e.date)}),d.value&&i.value.reverse()):s=="time"?(i.value.sort((t,e)=>{var a;return(a=t==null?void 0:t.time)==null?void 0:a.localeCompare(e==null?void 0:e.time)}),d.value&&i.value.reverse()):s=="status"&&(i.value.sort((t,e)=>{var a;return(a=t==null?void 0:t.status)==null?void 0:a.localeCompare(e==null?void 0:e.status)}),d.value&&i.value.reverse()),d.value=!d.value}return(s,t)=>(v(),V(P,null,[_(ee),_(n(te),{visible:z.value,"onUpdate:visible":t[1]||(t[1]=e=>z.value=e),modal:"",header:"Request Comments",style:{width:"50vw"}},{default:q(()=>[l("div",oe,[(v(!0),V(P,null,O(i.value[F.value].comments,e=>(v(),V("div",{class:H(["msg",{admin:(e==null?void 0:e.sender_type)=="Admin",parent:(e==null?void 0:e.sender_type)=="Parent"}])},o(e.msg),3))),256))]),l("div",ue,[_(n(ie),{modelValue:g.value,"onUpdate:modelValue":t[0]||(t[0]=e=>g.value=e)},null,8,["modelValue"]),_(n(B),{label:"Add Comment",onClick:J})])]),_:1},8,["visible"]),l("div",ce,[_(R,{class:"sidebar",selected:"Manage Requests"}),l("div",re,[de,l("div",me,[l("div",pe,[l("h3",{onClick:t[2]||(t[2]=e=>w("parent"))},[C(o(n(m)(n(f).parentEmail))+" ",1),_e]),l("h3",{onClick:t[3]||(t[3]=e=>w("child"))},[C(o(n(m)(n(f).childEmail))+" ",1),ve]),l("h3",{onClick:t[4]||(t[4]=e=>w("title"))},[C(o(n(m)(n(f).courseTitle))+" ",1),fe]),l("h3",{onClick:t[5]||(t[5]=e=>w("price"))},[C(o(n(m)(n(f).price))+" ",1),he]),l("h3",{onClick:t[6]||(t[6]=e=>w("date"))},[C(o(n(m)(n(f).date))+" ",1),we]),l("h3",{onClick:t[7]||(t[7]=e=>w("status"))},[C(o(n(m)(n(f).status))+" ",1),Ce]),l("h3",null,o(n(m)(n(f).actions)),1)]),(v(!0),V(P,null,O(i.value,(e,a)=>(v(),V("div",ke,[l("span",null,o(e.parentEmail),1),l("span",null,o(e.childEmail),1),l("span",null,o(n(m)(e.courseTitle)),1),l("span",null,o(e.price)+" L.E.",1),l("span",null,o(e.date),1),l("span",{class:H({pending:e.status=="Pending",rejected:e.status=="Rejected",accepted:e.status=="Success"})},o(e.status),3),l("span",ge,[_(n(B),{onClick:u=>{F.value=a,z.value=!0},style:{"font-size":"0.7rem",width:"100%"},label:"Show Comments"},null,8,["onClick"]),e.status=="Pending"?(v(),U(n(B),{key:0,onClick:()=>{K(e)},style:{"font-size":"0.7rem",width:"100%","background-color":"var(--correctAnswer)",color:"black"},label:"Accept"},null,8,["onClick"])):Y("",!0),e.status=="Pending"?(v(),U(n(B),{key:1,onClick:()=>{Q(e.id)},style:{"font-size":"0.7rem",width:"100%","background-color":"var(--wrongAnswer)"},label:"Reject"},null,8,["onClick"])):Y("",!0)])]))),256))])])]),_(se)],64))}}),ye=ne(Se,[["__scopeId","data-v-31e4d351"]]);export{ye as default};
