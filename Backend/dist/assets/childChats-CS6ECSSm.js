import{C as R}from"./ChildSidebar-D5Vem0_X.js";import{d as B,r as v,a as H,L as k,x as A,c as J,b as _,e as S,f as x,C as O,w as V,i as q,H as M,o as E,N as L,F as P,_ as T}from"./index-DPyxnlxI.js";import{r as Y}from"./vue-advanced-chat.es-BmVsTRj_.js";const j={class:"container"},z={class:"wrapper"},G=["current-user-id","rooms","rooms-loaded","room-id","messages","messages-loaded"],K=B({__name:"childChats",setup(Q){var C;Y();const u=v(!1),m=V(),I=q();function D(t){const e=new Date(t),a=e.getFullYear(),n=(e.getMonth()+1).toString().padStart(2,"0"),d=e.getDate().toString().padStart(2,"0");return`${a}-${n}-${d}`}function F(t){const e=new Date(t),a=e.getHours().toString().padStart(2,"0"),n=e.getMinutes().toString().padStart(2,"0");return`${a}:${n}`}const p=H(),b=(C=p.getInfo)==null?void 0:C.id,w=k(()=>{var t,e;if((t=m.params)!=null&&t.id)return(e=m.params)==null?void 0:e.id});A(w,()=>{u.value=!1,g()});const h=v([]),c=v([]),g=()=>{h.value=[],c.value=[],new M("get_chats").callApi().then(t=>{var e,a,n,d,i,N,$;if(t!=null&&t.success){let s=(e=t==null?void 0:t.data)==null?void 0:e.chat;for(let o=0;o<(s==null?void 0:s.length);o++){let r=(a=s[o])==null?void 0:a.participants;for(let f=0;f<(r==null?void 0:r.length);f++)r[f]._id=(n=r[f])==null?void 0:n.id;h.value.push({roomId:(d=s[o])==null?void 0:d.id,roomName:(i=s[o])==null?void 0:i.course_title,avatar:(N=s[o])==null?void 0:N.avatar,users:r})}let l=($=s==null?void 0:s.find(o=>{var r;return(o==null?void 0:o.id)==((r=m.params)==null?void 0:r.id)}))==null?void 0:$.messages;for(let o=0;o<(l==null?void 0:l.length);o++)l[o]._id=l[o].id,c.value.push(l[o]);u.value=!0}})};g();const y=t=>{var n,d;let e=new Date,a={chat_id:t==null?void 0:t.roomId,message:{content:t==null?void 0:t.content,senderId:(n=p.getInfo)==null?void 0:n.id,username:(d=p.getInfo)==null?void 0:d.email,date:D(String(e)),timestamp:F(String(e)),id:c.value.length}};I.push(`/childChats/${t==null?void 0:t.roomId}`),new M("send_message").callApi(a).then(i=>{i!=null&&i.success&&g()})};return(t,e)=>(E(),J(O,null,[_(L),S("div",j,[_(R,{class:"sidebar",selected:"Chats"}),S("div",z,[S("vue-advanced-chat",{height:"80vh","current-user-id":x(b),rooms:JSON.stringify(h.value),"rooms-loaded":u.value,"room-id":w.value,messages:JSON.stringify(c.value),"messages-loaded":u.value,"load-first-room":!0,"show-add-room":!1,"show-files":!1,"show-audio":!1,onSendMessage:e[0]||(e[0]=a=>y(a.detail[0])),onFetchMessages:e[1]||(e[1]=a=>x(I).push(`/childChats/${a.detail[0].room.roomId}`))},null,40,G)])]),_(P)],64))}}),W=T(K,[["__scopeId","data-v-84c00140"]]);export{W as default};
