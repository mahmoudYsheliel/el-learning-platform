import{A as b}from"./AdminSidebar-nMJr8tSv.js";import{d as q,r as T,H as d,c as D,b as p,D as R,f as i,e as l,h as C,t as c,w as L,x as O,o as v,N as ee,z as H,l as te,m as B,K as se,s as m,k as f,I as U,g as K,F as le,p as ae,n as ie,_ as ne}from"./index-QBm80XMo.js";const h=V=>(ae("data-v-31ca1367"),V=V(),ie(),V),oe={class:"msg-wrapper"},ue={class:"add-comment"},ce={class:"container"},de={class:"wrapper"},re=h(()=>l("h2",null,"Enrollment Requests",-1)),_e={class:"table-container"},me={class:"row head"},pe=h(()=>l("i",{class:"pi pi-sort-alt"},null,-1)),ve=h(()=>l("i",{class:"pi pi-sort-alt"},null,-1)),fe=h(()=>l("i",{class:"pi pi-sort-alt"},null,-1)),he=h(()=>l("i",{class:"pi pi-sort-alt"},null,-1)),we=h(()=>l("i",{class:"pi pi-sort-alt"},null,-1)),Ce=h(()=>l("i",{class:"pi pi-sort-alt"},null,-1)),ke={class:"row"},ge={style:{display:"flex","flex-direction":"column",gap:"0.5rem","margin-block":"1rem"}},Se=q({__name:"manageRequests",setup(V){const n=T([]),Y=new d("get_all_request_enrollment");async function k(){n.value=[],Y.callApi().then(s=>{var t;if((s==null?void 0:s.success)==!0)for(let e of(t=s==null?void 0:s.data)==null?void 0:t.requests)new d("personal_another_user_info").callApi({another_userId:e==null?void 0:e.parent_id}).then(o=>{new d("personal_another_user_info").callApi({another_userId:e==null?void 0:e.student_id}).then(r=>{(r==null?void 0:r.success)==!0&&(e.package_type=="course"?new d("get_course").callApi({course_id:e==null?void 0:e.course_id}).then(u=>{var S,A,E,I,y,$,x;(u==null?void 0:u.success)==!0&&((x=n.value)==null||x.push({id:e==null?void 0:e.id,parentEmail:(A=(S=o==null?void 0:o.data)==null?void 0:S.info)==null?void 0:A.email,childEmail:(I=(E=r==null?void 0:r.data)==null?void 0:E.info)==null?void 0:I.email,courseTitle:($=(y=u==null?void 0:u.data)==null?void 0:y.course)==null?void 0:$.title,date:M(e==null?void 0:e.created_at),status:e==null?void 0:e.status,price:e==null?void 0:e.price,comments:e==null?void 0:e.comments,student_id:e==null?void 0:e.student_id,course_id:e==null?void 0:e.course_id,courses:[],type:"course"}),g.value="",n.value.sort((j,z)=>j.id.localeCompare(z.id)))}):e.package_type=="plan"&&new d("get_plan").callApi({plan_id:e==null?void 0:e.course_id}).then(u=>{var S,A,E,I,y,$,x,j,z;(u==null?void 0:u.success)==!0&&((z=n.value)==null||z.push({id:e==null?void 0:e.id,parentEmail:(A=(S=o==null?void 0:o.data)==null?void 0:S.info)==null?void 0:A.email,childEmail:(I=(E=r==null?void 0:r.data)==null?void 0:E.info)==null?void 0:I.email,courseTitle:($=(y=u==null?void 0:u.data)==null?void 0:y.plan)==null?void 0:$.title,date:M(e==null?void 0:e.created_at),status:e==null?void 0:e.status,price:e==null?void 0:e.price,comments:e==null?void 0:e.comments,student_id:e==null?void 0:e.student_id,course_id:e==null?void 0:e.course_id,courses:(j=(x=u==null?void 0:u.data)==null?void 0:x.plan)==null?void 0:j.courses,type:"plan"}),g.value="",n.value.sort((X,Z)=>X.id.localeCompare(Z.id)))}))})})})}k();function M(s){const t=new Date(s),e=t.getFullYear(),a=(t.getMonth()+1).toString().padStart(2,"0"),o=t.getDate().toString().padStart(2,"0");return`${e}-${a}-${o}`}const F=T(!1),P=T(-1),g=T("");function G(){let s={enrollment_request_id:n.value[P.value].id,msg:{msg:g.value}};new d("add_comment").callApi(s).then(e=>{e!=null&&e.success&&k()})}function J(s){if(s.type=="course"){const t=new d("edit_request_status");new d("create_enrollment").callApi({new_enrollment:{student_id:s.student_id,course_id:s.course_id,created_at:new Date().toISOString()}}).then(a=>{a!=null&&a.success&&t.callApi({new_status:"Success",enrollment_request_id:s.id}).then(o=>{o!=null&&o.success&&k()})})}if(s.type=="plan"){const t=new d("edit_request_status");for(let e of s.courses)new d("create_enrollment").callApi({new_enrollment:{student_id:s.student_id,course_id:e==null?void 0:e.Id,created_at:new Date().toISOString()}}).then(o=>{o!=null&&o.success&&t.callApi({new_status:"Success",enrollment_request_id:s.id}).then(N=>{N!=null&&N.success&&k()})})}}function Q(s){new d("edit_request_status").callApi({new_status:"Rejected",enrollment_request_id:s}).then(e=>{e!=null&&e.success&&k()})}const _=T(!1);function w(s){s=="price"?(n.value.sort((t,e)=>(t==null?void 0:t.price)-(e==null?void 0:e.price)),_.value&&n.value.reverse()):s=="parent"?(n.value.sort((t,e)=>{var a;return(a=t==null?void 0:t.parentEmail)==null?void 0:a.localeCompare(e==null?void 0:e.parentEmail)}),_.value&&n.value.reverse()):s=="title"?(n.value.sort((t,e)=>{var a;return(a=t==null?void 0:t.courseTitle)==null?void 0:a.localeCompare(e==null?void 0:e.courseTitle)}),_.value&&n.value.reverse()):s=="date"?(n.value.sort((t,e)=>{var a;return(a=t==null?void 0:t.date)==null?void 0:a.localeCompare(e==null?void 0:e.date)}),_.value&&n.value.reverse()):s=="time"?(n.value.sort((t,e)=>{var a;return(a=t==null?void 0:t.time)==null?void 0:a.localeCompare(e==null?void 0:e.time)}),_.value&&n.value.reverse()):s=="status"&&(n.value.sort((t,e)=>{var a;return(a=t==null?void 0:t.status)==null?void 0:a.localeCompare(e==null?void 0:e.status)}),_.value&&n.value.reverse()),_.value=!_.value}return(s,t)=>(v(),D(L,null,[p(ee),p(i(se),{visible:F.value,"onUpdate:visible":t[1]||(t[1]=e=>F.value=e),modal:"",header:"Request Comments",style:{width:"50vw"}},{default:R(()=>[l("div",oe,[(v(!0),D(L,null,O(n.value[P.value].comments,e=>(v(),D("div",{class:H(["msg",{admin:(e==null?void 0:e.sender_type)=="Admin",parent:(e==null?void 0:e.sender_type)=="Parent"}])},c(e.msg),3))),256))]),l("div",ue,[p(i(te),{modelValue:g.value,"onUpdate:modelValue":t[0]||(t[0]=e=>g.value=e)},null,8,["modelValue"]),p(i(B),{label:"Add Comment",onClick:G})])]),_:1},8,["visible"]),l("div",ce,[p(b,{class:"sidebar",selected:"Manage Requests"}),l("div",de,[re,l("div",_e,[l("div",me,[l("h3",{onClick:t[2]||(t[2]=e=>w("parent"))},[C(c(i(m)(i(f).parentEmail))+" ",1),pe]),l("h3",{onClick:t[3]||(t[3]=e=>w("child"))},[C(c(i(m)(i(f).childEmail))+" ",1),ve]),l("h3",{onClick:t[4]||(t[4]=e=>w("title"))},[C(c(i(m)(i(f).courseTitle))+" ",1),fe]),l("h3",{onClick:t[5]||(t[5]=e=>w("price"))},[C(c(i(m)(i(f).price))+" ",1),he]),l("h3",{onClick:t[6]||(t[6]=e=>w("date"))},[C(c(i(m)(i(f).date))+" ",1),we]),l("h3",{onClick:t[7]||(t[7]=e=>w("status"))},[C(c(i(m)(i(f).status))+" ",1),Ce]),l("h3",null,c(i(m)(i(f).actions)),1)]),(v(!0),D(L,null,O(n.value,(e,a)=>(v(),D("div",ke,[l("span",null,c(e.parentEmail),1),l("span",null,c(e.childEmail),1),l("span",null,c(i(m)(e.courseTitle)),1),l("span",null,c(e.price)+" L.E.",1),l("span",null,c(e.date),1),l("span",{class:H({pending:e.status=="Pending",rejected:e.status=="Rejected",accepted:e.status=="Success"})},c(e.status),3),l("span",ge,[p(i(B),{onClick:o=>{P.value=a,F.value=!0},style:{"font-size":"0.7rem",width:"100%"},label:"Show Comments"},null,8,["onClick"]),e.status=="Pending"?(v(),U(i(B),{key:0,onClick:()=>{J(e)},style:{"font-size":"0.7rem",width:"100%","background-color":"var(--correctAnswer)",color:"black"},label:"Accept"},null,8,["onClick"])):K("",!0),e.status=="Pending"?(v(),U(i(B),{key:1,onClick:()=>{Q(e.id)},style:{"font-size":"0.7rem",width:"100%","background-color":"var(--wrongAnswer)"},label:"Reject"},null,8,["onClick"])):K("",!0)])]))),256))])])]),p(le)],64))}}),Ie=ne(Se,[["__scopeId","data-v-31ca1367"]]);export{Ie as default};
