import{I as R}from"./InstructorSideBar-DNg2HvKw.js";import{d as H,r as _,a as k,E as A,Z as E,c as J,b as g,e as v,f as x,w as O,G as V,i as q,H as D,o as G,N as P,F as T,_ as Y}from"./index-BUqRmQ9k.js";import{r as Z}from"./vue-advanced-chat.es-BmVsTRj_.js";const j={class:"container"},z={class:"wrapper"},K=["current-user-id","rooms","rooms-loaded","room-id","messages","messages-loaded"],L=H({__name:"instructorChats",setup(Q){var N;Z();const l=_(!1),I=V(),S=q();function F(t){const e=new Date(t),a=e.getFullYear(),n=(e.getMonth()+1).toString().padStart(2,"0"),d=e.getDate().toString().padStart(2,"0");return`${a}-${n}-${d}`}function b(t){const e=new Date(t),a=e.getHours().toString().padStart(2,"0"),n=e.getMinutes().toString().padStart(2,"0");return`${a}:${n}`}const m=k(),y=(N=m.getInfo)==null?void 0:N.id,w=A(()=>{var t;return(t=I.params)==null?void 0:t.id});E(w,()=>{l.value=!1,h()});const p=_([]),c=_([]),h=()=>{p.value=[],c.value=[],new D("get_chats").callApi().then(t=>{var e,a,n,d,i,$,C,M;if(t!=null&&t.success){let s=(e=t==null?void 0:t.data)==null?void 0:e.chat;for(let o=0;o<(s==null?void 0:s.length);o++){let r=(a=s[o])==null?void 0:a.participants;for(let f=0;f<(r==null?void 0:r.length);f++)r[f]._id=(n=r[f])==null?void 0:n.id;p.value.push({roomId:(d=s[o])==null?void 0:d.id,roomName:((i=s[o])==null?void 0:i.course_title)+" "+(($=s[o])==null?void 0:$.student_name),avatar:(C=s[o])==null?void 0:C.avatar,users:r})}let u=(M=s==null?void 0:s.find(o=>{var r;return(o==null?void 0:o.id)==((r=I.params)==null?void 0:r.id)}))==null?void 0:M.messages;for(let o=0;o<(u==null?void 0:u.length);o++)u[o]._id=u[o].id,c.value.push(u[o]);l.value=!0}})};h();const B=t=>{var n,d;let e=new Date,a={chat_id:t==null?void 0:t.roomId,message:{content:t==null?void 0:t.content,senderId:(n=m.getInfo)==null?void 0:n.id,username:(d=m.getInfo)==null?void 0:d.email,date:F(String(e)),timestamp:b(String(e)),id:c.value.length}};S.push(`/instructorChats/${t==null?void 0:t.roomId}`),new D("send_message").callApi(a).then(i=>{i!=null&&i.success&&h()})};return(t,e)=>(G(),J(O,null,[g(P),v("div",j,[g(R,{selected:"Chats",class:"sidebar"}),v("div",z,[v("vue-advanced-chat",{height:"80vh","current-user-id":x(y),rooms:JSON.stringify(p.value),"rooms-loaded":l.value,"room-id":w.value,messages:JSON.stringify(c.value),"messages-loaded":l.value,"load-first-room":!0,"show-add-room":!1,"show-files":!1,"show-audio":!1,onSendMessage:e[0]||(e[0]=a=>B(a.detail[0])),onFetchMessages:e[1]||(e[1]=a=>x(S).push(`/instructorChats/${a.detail[0].room.roomId}`))},null,40,K)])]),g(T)],64))}}),tt=Y(L,[["__scopeId","data-v-8b6c981f"]]);export{tt as default};
