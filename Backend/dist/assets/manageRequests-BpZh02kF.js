import{A as X}from"./AdminSidebar-DIDE47_D.js";import{d as Z,r as x,H as c,c as T,b as v,z as b,f as i,e as s,h as C,t as d,C as F,D as L,o as f,N as q,A as M,l as R,m as j,B as ee,s as p,k as _,y as O,g as H,F as te,_ as le}from"./index-B-SXsqfT.js";const se={class:"msg-wrapper"},ae={class:"add-comment"},ie={class:"container"},ne={class:"wrapper"},oe={class:"table-container"},ue={class:"row head"},de={class:"row"},ce={style:{display:"flex","flex-direction":"column",gap:"0.5rem","margin-block":"1rem"}},re=Z({__name:"manageRequests",setup(me){const n=x([]),U=new c("get_all_request_enrollment");async function h(){n.value=[],U.callApi().then(l=>{var t;if((l==null?void 0:l.success)==!0)for(let e of(t=l==null?void 0:l.data)==null?void 0:t.requests)new c("personal_another_user_info").callApi({another_userId:e==null?void 0:e.parent_id}).then(o=>{new c("personal_another_user_info").callApi({another_userId:e==null?void 0:e.student_id}).then(r=>{(r==null?void 0:r.success)==!0&&(e.package_type=="course"?new c("get_course").callApi({course_id:e==null?void 0:e.course_id}).then(u=>{var g,A,S,E,y,I,$;(u==null?void 0:u.success)==!0&&(($=n.value)==null||$.push({id:e==null?void 0:e.id,parentEmail:(A=(g=o==null?void 0:o.data)==null?void 0:g.info)==null?void 0:A.email,childEmail:(E=(S=r==null?void 0:r.data)==null?void 0:S.info)==null?void 0:E.email,courseTitle:(I=(y=u==null?void 0:u.data)==null?void 0:y.course)==null?void 0:I.title,date:P(e==null?void 0:e.created_at),status:e==null?void 0:e.status,price:e==null?void 0:e.price,comments:e==null?void 0:e.comments,student_id:e==null?void 0:e.student_id,course_id:e==null?void 0:e.course_id,courses:[],type:"course"}),k.value="",n.value.sort((V,N)=>V.id.localeCompare(N.id)))}):e.package_type=="plan"&&new c("get_plan").callApi({plan_id:e==null?void 0:e.course_id}).then(u=>{var g,A,S,E,y,I,$,V,N;(u==null?void 0:u.success)==!0&&((N=n.value)==null||N.push({id:e==null?void 0:e.id,parentEmail:(A=(g=o==null?void 0:o.data)==null?void 0:g.info)==null?void 0:A.email,childEmail:(E=(S=r==null?void 0:r.data)==null?void 0:S.info)==null?void 0:E.email,courseTitle:(I=(y=u==null?void 0:u.data)==null?void 0:y.plan)==null?void 0:I.title,date:P(e==null?void 0:e.created_at),status:e==null?void 0:e.status,price:e==null?void 0:e.price,comments:e==null?void 0:e.comments,student_id:e==null?void 0:e.student_id,course_id:e==null?void 0:e.course_id,courses:(V=($=u==null?void 0:u.data)==null?void 0:$.plan)==null?void 0:V.courses,type:"plan"}),k.value="",n.value.sort((Q,W)=>Q.id.localeCompare(W.id)))}))})})})}h();function P(l){const t=new Date(l),e=t.getFullYear(),a=(t.getMonth()+1).toString().padStart(2,"0"),o=t.getDate().toString().padStart(2,"0");return`${e}-${a}-${o}`}const z=x(!1),B=x(-1),k=x("");function Y(){let l={enrollment_request_id:n.value[B.value].id,msg:{msg:k.value}};new c("add_comment").callApi(l).then(e=>{e!=null&&e.success&&h()})}function G(l){if(l.type=="course"){const t=new c("edit_request_status");new c("create_enrollment").callApi({new_enrollment:{student_id:l.student_id,course_id:l.course_id,created_at:new Date().toISOString()}}).then(a=>{a!=null&&a.success&&t.callApi({new_status:"Success",enrollment_request_id:l.id}).then(o=>{o!=null&&o.success&&h()})})}if(l.type=="plan"){const t=new c("edit_request_status");for(let e of l.courses)new c("create_enrollment").callApi({new_enrollment:{student_id:l.student_id,course_id:e==null?void 0:e.Id,created_at:new Date().toISOString()}}).then(o=>{o!=null&&o.success&&t.callApi({new_status:"Success",enrollment_request_id:l.id}).then(D=>{D!=null&&D.success&&h()})})}}function J(l){new c("edit_request_status").callApi({new_status:"Rejected",enrollment_request_id:l}).then(e=>{e!=null&&e.success&&h()})}const m=x(!1);function w(l){l=="price"?(n.value.sort((t,e)=>(t==null?void 0:t.price)-(e==null?void 0:e.price)),m.value&&n.value.reverse()):l=="parent"?(n.value.sort((t,e)=>{var a;return(a=t==null?void 0:t.parentEmail)==null?void 0:a.localeCompare(e==null?void 0:e.parentEmail)}),m.value&&n.value.reverse()):l=="title"?(n.value.sort((t,e)=>{var a;return(a=t==null?void 0:t.courseTitle)==null?void 0:a.localeCompare(e==null?void 0:e.courseTitle)}),m.value&&n.value.reverse()):l=="date"?(n.value.sort((t,e)=>{var a;return(a=t==null?void 0:t.date)==null?void 0:a.localeCompare(e==null?void 0:e.date)}),m.value&&n.value.reverse()):l=="time"?(n.value.sort((t,e)=>{var a;return(a=t==null?void 0:t.time)==null?void 0:a.localeCompare(e==null?void 0:e.time)}),m.value&&n.value.reverse()):l=="status"&&(n.value.sort((t,e)=>{var a;return(a=t==null?void 0:t.status)==null?void 0:a.localeCompare(e==null?void 0:e.status)}),m.value&&n.value.reverse()),m.value=!m.value}return(l,t)=>(f(),T(F,null,[v(q),v(i(ee),{visible:z.value,"onUpdate:visible":t[1]||(t[1]=e=>z.value=e),modal:"",header:"Request Comments",style:{width:"50vw"}},{default:b(()=>[s("div",se,[(f(!0),T(F,null,L(n.value[B.value].comments,e=>(f(),T("div",{class:M(["msg",{admin:(e==null?void 0:e.sender_type)=="Admin",parent:(e==null?void 0:e.sender_type)=="Parent"}])},d(e.msg),3))),256))]),s("div",ae,[v(i(R),{modelValue:k.value,"onUpdate:modelValue":t[0]||(t[0]=e=>k.value=e)},null,8,["modelValue"]),v(i(j),{label:"Add Comment",onClick:Y})])]),_:1},8,["visible"]),s("div",ie,[v(X,{class:"sidebar",selected:"Manage Requests"}),s("div",ne,[t[14]||(t[14]=s("h2",null,"Enrollment Requests",-1)),s("div",oe,[s("div",ue,[s("h3",{onClick:t[2]||(t[2]=e=>w("parent"))},[C(d(i(p)(i(_).parentEmail))+" ",1),t[8]||(t[8]=s("i",{class:"pi pi-sort-alt"},null,-1))]),s("h3",{onClick:t[3]||(t[3]=e=>w("child"))},[C(d(i(p)(i(_).childEmail))+" ",1),t[9]||(t[9]=s("i",{class:"pi pi-sort-alt"},null,-1))]),s("h3",{onClick:t[4]||(t[4]=e=>w("title"))},[C(d(i(p)(i(_).courseTitle))+" ",1),t[10]||(t[10]=s("i",{class:"pi pi-sort-alt"},null,-1))]),s("h3",{onClick:t[5]||(t[5]=e=>w("price"))},[C(d(i(p)(i(_).price))+" ",1),t[11]||(t[11]=s("i",{class:"pi pi-sort-alt"},null,-1))]),s("h3",{onClick:t[6]||(t[6]=e=>w("date"))},[C(d(i(p)(i(_).date))+" ",1),t[12]||(t[12]=s("i",{class:"pi pi-sort-alt"},null,-1))]),s("h3",{onClick:t[7]||(t[7]=e=>w("status"))},[C(d(i(p)(i(_).status))+" ",1),t[13]||(t[13]=s("i",{class:"pi pi-sort-alt"},null,-1))]),s("h3",null,d(i(p)(i(_).actions)),1)]),(f(!0),T(F,null,L(n.value,(e,a)=>(f(),T("div",de,[s("span",null,d(e.parentEmail),1),s("span",null,d(e.childEmail),1),s("span",null,d(i(p)(e.courseTitle)),1),s("span",null,d(e.price)+" L.E.",1),s("span",null,d(e.date),1),s("span",{class:M({pending:e.status=="Pending",rejected:e.status=="Rejected",accepted:e.status=="Success"})},d(e.status),3),s("span",ce,[v(i(j),{onClick:o=>{B.value=a,z.value=!0},style:{"font-size":"0.7rem",width:"100%"},label:"Show Comments"},null,8,["onClick"]),e.status=="Pending"?(f(),O(i(j),{key:0,onClick:()=>{G(e)},style:{"font-size":"0.7rem",width:"100%","background-color":"var(--correctAnswer)",color:"black"},label:"Accept"},null,8,["onClick"])):H("",!0),e.status=="Pending"?(f(),O(i(j),{key:1,onClick:()=>{J(e.id)},style:{"font-size":"0.7rem",width:"100%","background-color":"var(--wrongAnswer)"},label:"Reject"},null,8,["onClick"])):H("",!0)])]))),256))])])]),v(te)],64))}}),fe=le(re,[["__scopeId","data-v-6264441f"]]);export{fe as default};
